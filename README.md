# nextcloud-decryptor

This script is based on SysEleven [decrypt-file.php](https://github.com/syseleven/nextcloud-tools/blob/master/decrypt-file.php) script and has been modified to support an automatic decryption of user data.

## Configuration
#### Nextcloud Definitions ([from SysEleven](https://github.com/syseleven/nextcloud-tools#nextcloud-definitions-1))
The Nextcloud definitions are values that you have to copy from the Nextcloud configuration file ("config/config.php"). The names of the values are equal to the ones found in the Nextcloud configuration file.

#### Custom Definitions ([from SysEleven](https://github.com/syseleven/nextcloud-tools#custom-definitions-1))
The custom definitions define how the `nxt-decryptor.php` script works internally. These are the supported configuration values:

* `DEBUGLEVEL` - defines how much output is generated by the script. `DEBUG_DEFAULT` and `DEBUG_INFO` only output the decrypted file content and negative results. `DEBUG_DEBUG` outputs the decrypted file content and negative results as well as details about the internal state of the script. (*Use `DEBUG_DEBUG` with caution as it can produce a lot of output.*)
* `KEYTYPE` - defines which key type shall be used to decrypt file keys. `KEY_MASTER` activates the master key support. `KEY_PUBSHARE` activates the public sharing key support. `KEY_RECOVERY` activates the recovery key support. `KEY_USER` activates the user key support.
* `RECOVERY_PASSWORD` - defines the password of the recovery key when the recovery key support is activated through `KEYTYPE`.
* `USER_NAME` - defines the name of the user key when the user key support is activated through `KEYTYPE`. 
* `USER_PASSWORD` - defines the password of the user key when the user key support is activated through `KEYTYPE`.

#### Saving Options
Default decryption location: `DATADIRECTORY/<username>/files_decrypted/`
* `SAVE_DECRYPT` - automatically save the decryption output.
* `OVERWRITE_ORIG` - save the decryption output to the original encrypted file (not recommended).

## Usage
`php ./nxt-decryptor.php <username> <custom-destination>`

Note: a custom destination isn't a requirement.
